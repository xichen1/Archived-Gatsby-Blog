---
title: 如何写一个简单的praser
date: "2020-06-21"
description: "compiler"
---
#如何写一个简单的praser

##起因
因为最近学了一点js, 准备做几个项目练练手, 就盯上了万年老坑计算器. 说他坑主要是因为可易可难, 如果要加上很多科学计算器的功能估计会很麻烦. 于是我就准备做一个只有最基础四则运算功能的版本. 看了几篇给js初学者看的文章发现基本都是先从基本逻辑讲起, 再不断往上堆功能最后再考虑边际情况. 感觉这种方法又啰嗦又不robust, 就突然想起了大一课上学过一个叫逆波兰表达式的东西(Reverse Polish notation), 貌似能很方便的计算任意的一个expression, 然后我就把js扔在了一边开始研究怎么把给出的一个数学expression转换成容易计算的形式.

##逆波兰表达式(RPN)
逆波兰表达式中的所有符号都在第二个操作数的后面
EX:
1 2 3 + *
在这个表达式里, +号在3后面, 所以+连接2和3, 而*号在2和3后面, 所以\*号连接1和(2+3).
使用stack后RPN的计算可以变得非常方便, 具体计算一个RPN值的方法是:
依次把token放进stack, 遇到operator时把入栈的token数字都拿出并且用operator连接求值, 将值放进stack. 遍历过一遍RPN后, stack顶的值就是这个RPN的值.
###问题
但是使用RPN计算一个表达式的值有一个问题, 就是如何把普通的expression又称中缀表达式转换成RPN. Wikipedia告诉我可以用一个叫调度场算法的方法来convert. 但由于其适应性不够(只能用在RPN问题中)而且貌似很难证明, 遂放弃. 而这个时候我发现了praser的存在.
##Praser
根据[王垠的博客](https://www.yinwang.org/blog-cn/2015/09/19/parser), praser是能把文本转换成一种叫抽象语法树(AST)的数据结构的工具. 对于1+2这样的表达式, 计算机无法直接对其计算, 而要通过AST来计算他的值. 
对于1+2这样的数学表达式来说AST是一个二叉树, 每一个node代表了一个操作符, 而二叉树的leaf则为最初始的操作数. //TODD: add img